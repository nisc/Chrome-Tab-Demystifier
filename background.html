<script>
  chrome.extension.onRequest.addListener(function(request, sender, sendResp) {
    chrome.browserAction.setPopup({
      tabId: sender.tab.id,
      popup: "popup.html"
    });

    chrome.browserAction.setIcon({
      tabId: sender.tab.id,
      path: "icons/icon_19.jpg"
    });

    chrome.browserAction.setBadgeText({
      tabId: sender.tab.id,
      text: "?"
    });

    chrome.browserAction.setTitle({
      tabId: sender.tab.id,
      title: "Ref: " + request.ref
    });
  });

  chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
    if(changeInfo['status'] == "complete") {
      chrome.tabs.executeScript(null, {
        file: "content.js"
      }, function() {});
    }
  });
</script>
